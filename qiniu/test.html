<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <title>Publish Page</title>
    </head>
    <body>
    <p>本地音视频轨</p>
    <div id="localtracks" style="width: 640px;"></div>
    <p>远端音视频轨</p>
    <div id="remotetracks" style="width: 640px;"></div>
    房间名：<input id="roomname" name="roomname" type="text">
    用户名：<input id="username" name="username" type="text">
    <button onclick="check()">jiancha</button>
    <!-- 这里引入我们的 SDK -->
    <script src="./tokenTool.js"></script>
    <script src="./hmac-sha1.js"></script>
    <script src="./enc-base64.js"></script>
    <script>
     
      let AK = "pHNNSR0R31i4gHfG7ZhznPjdpfyXxrr7Y6702uog";
      let SK = "0J1v1pzo5DDK8bAVbYGTxAlWqIkTg2MGA21jH7PA";
      // 生成roomtoken 初始化为空
      let roomAccess = {
        "appId": "e16nfe56c",
        "roomName": "aaa",
        "userId": "aaa",
        "expireAt": 1550813144, //默认失效时间大约一天
        "permission": "user"
      };
      //setp2
      let roomAccessString = JSON.stringify(roomAccess); 
      //setp3
      let encodedRoomAccess = base64encode(utf16to8(roomAccessString));
      console.log(encodedRoomAccess)
      // 4. 计算HMAC-SHA1签名，并对签名结果做URL安全的Base64编码
      let sign = CryptoJS.HmacSHA1(encodedRoomAccess, SK)
      //
      let sign2 = JSON.stringify(sign); 
      // console.log(sign)
      // console.log(sign2)
      // console.log(safe64(sign))
      // let encodedSign = base64encode(utf16to8(sign.toString()));
      // let encodedSign = sign.toString(CryptoJS.enc.Base64);
      let encodedSign = base64encode(utf16to8(sign2));
      // let a = safe64(encodedSign);
      console.log(encodedSign)
      // console.log(a)
      // console.log(encodedSign2)
      // setp5. 将AccessKey与以上两者拼接得到房间鉴权
      roomToken = AK + ":" + encodedSign + ":" + encodedRoomAccess;
      console.log(roomToken)
      
    </script>
    </body>
</html>
pHNNSR0R31i4gHfG7ZhznPjdpfyXxrr7Y6702uog:b-f2_azDo2-dHmTTo_ctiafByRE=:eyJhcHBJZCI6ImUxNm5mZTU2YyIsInJvb21OYW1lIjoiY2RkIiwidXNlcklkIjoiMTIzIiwiZXhwaXJlQXQiOjE1NTA4OTA5NzMsInBlcm1pc3Npb24iOiJ1c2VyIn0=
pHNNSR0R31i4gHfG7ZhznPjdpfyXxrr7Y6702uog:b-f2_azDo2-dHmTTo_ctiafByRE=:eyJhcHBJZCI6ImUxNm5mZTU2YyIsInJvb21OYW1lIjoiY2RkIiwidXNlcklkIjoiMTIzIiwiZXhwaXJlQXQiOjE1NTA4OTA5NzMsInBlcm1pc3Npb24iOiJ1c2VyIn0=
//生成roomtoken 初始化为空
      let roomToken = null;
      function check(){
        let roomname = document.getElementById("roomname").value;
        let username = document.getElementById("username").value;
        if(roomname && username){






          let roomAccess = {
            "appId": "e16nfe56c",
            "roomName": roomname,
            "userId": username,
            "expireAt": 1550813144, //默认失效时间大约一天
            "permission": "user"
          };
          let roomAccessString = json_to_string(roomAccess); 
          let encodedRoomAccess = urlsafe_base64_encode(roomAccessString)
          // 2. 计算HMAC-SHA1签名，并对签名结果做URL安全的Base64编码
          let sign = hmac_sha1(encodedRoomAccess, "0J1v1pzo5DDK8bAVbYGTxAlWqIkTg2MGA21jH7PA")
          let encodedSign = urlsafe_base64_encode(sign)
          // 3. 将AccessKey与以上两者拼接得到房间鉴权
          roomToken = "pHNNSR0R31i4gHfG7ZhznPjdpfyXxrr7Y6702uog" + ":" + encodedSign + ":" + encodedRoomAccess;
        }else{
          alert("请输入用户名和房间名")
          return false
        }
      }